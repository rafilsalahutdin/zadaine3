{
  "name": "–∏—Ä–±–∏—Å",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1008,
        -784
      ],
      "id": "e8fcf37c-010b-42d4-a4fa-bb363a6d3555",
      "name": "Telegram Trigger",
      "webhookId": "549c8796-285c-4d9d-b0ce-026f43748ae2",
      "credentials": {
        "telegramApi": {
          "id": "tA1BREjnYhtL43R3",
          "name": "irbsac19076_bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/start",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "b1151817-279e-4d99-a463-5f5e7b84ae00"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "/start"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "a17e67f3-6a1b-4ad3-b878-6823da5c8acf",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "—Ñ–µ–π—Ö—É–∞",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f2b5f23b-f4d8-49b7-9378-bd0b302b6e84",
                    "leftValue": "={{ $json.message.document }}",
                    "rightValue": "",
                    "operator": {
                      "type": "object",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "file"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -496,
        -800
      ],
      "id": "93fc068e-b922-40b4-bb55-d750e11c10ce",
      "name": "Switch"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "=–ü—Ä–∏—à–ª–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ñ–∞–π–ª —Ç–∞–±–ª–∏—Ü—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ .xlsx",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        -976
      ],
      "id": "6b53a605-109a-47e9-8fc0-a786a1b2f3e4",
      "name": "Send a text message1",
      "webhookId": "ee828d24-cef6-4732-b00c-9ab4e87e3808",
      "credentials": {
        "telegramApi": {
          "id": "tA1BREjnYhtL43R3",
          "name": "irbsac19076_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–æ–¥—ã\nconst employees = $input.all().map(item => item.json);\nconst chatId = $('Telegram Trigger').first().json.message.chat.id;\n\n\nif (!employees || employees.length === 0) {\n  return [{\n    json: {\n      text: \"‚ùå –í —Ñ–∞–π–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö.\"\n    }\n  }];\n}\n\n// –ù–∞—á–∏–Ω–∞–µ–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\nlet message = \"üìä *–°–≤–æ–¥–∫–∞ –ø–æ –∑–∞–¥–∞—á–∞–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤*\\n\\n\";\n\nlet totalTasks = 0;\nlet totalDone = 0;\nlet totalOnTime = 0;\n\nfor (const emp of employees) {\n  message += `üë§ *${emp[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"]}*\\n`;\n  message += `üìå –í—Å–µ–≥–æ –∑–∞–¥–∞—á: ${emp[\"–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á\"]}\\n`;\n  message += `‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${emp[\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\"]}\\n`;\n  message += `üéØ –í —Å—Ä–æ–∫: ${emp[\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\"]}\\n`;\n  message += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\\n`;\n\n  totalTasks += emp[\"–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á\"];\n  totalDone += emp[\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\"];\n  totalOnTime += emp[\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\"];\n}\n\n// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\nmessage += `\\nüìà *–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*\\n`;\nmessage += `üîπ –í—Å–µ–≥–æ –∑–∞–¥–∞—á: ${totalTasks}\\n`;\nmessage += `üîπ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${totalDone}\\n`;\nmessage += `üîπ –í —Å—Ä–æ–∫: ${totalOnTime}`;\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è Telegram\nreturn [{\n  json: {\n    chatId: chatId,\n    text: message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        752,
        -816
      ],
      "id": "128aa8aa-fe2d-454f-aed0-d3ac95962faa",
      "name": "–û—Ç—á–µ—Ç"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "6169ebf4-a550-47c1-9b42-337028897534",
              "leftValue": "={{ $json.message.document.mime_type }}",
              "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -288,
        -704
      ],
      "id": "1a2ef82e-dc83-40da-bbf3-1d8b7ce966e9",
      "name": "If xlsx"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        256,
        -560
      ],
      "id": "150255f9-ce0f-49d7-a568-863ea5ead34e",
      "name": "Extract from File"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Telegram Trigger').item.json.message.document.file_id }}",
        "additionalFields": {}
      },
      "id": "c16d357d-f23a-471e-960e-b3c7f0ee23a2",
      "name": "Get File",
      "type": "n8n-nodes-base.telegram",
      "position": [
        -16,
        -560
      ],
      "webhookId": "f429aa15-6d58-4194-9474-90da35af3610",
      "typeVersion": 1.1,
      "credentials": {
        "telegramApi": {
          "id": "tA1BREjnYhtL43R3",
          "name": "irbsac19076_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "xlsx",
        "binaryPropertyName": "file",
        "options": {
          "fileName": "=–ó–∞–¥–∞—á–∏.xlsx",
          "headerRow": true,
          "sheetName": "–ó–∞–¥–∞—á–∏"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        976,
        -608
      ],
      "id": "ed17246f-67eb-4135-8e2b-2b33dfbf1bb7",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "binaryPropertyName": "file",
        "options": {
          "fileName": "=–°–≤–æ–¥.xlsx",
          "headerRow": true,
          "sheetName": "–°–≤–æ–¥"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        976,
        -416
      ],
      "id": "9f23bd83-ffba-4db5-8bb4-e8663358b2bd",
      "name": "Convert to File1"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ —Ñ–∞–π–ª–∞\nconst tasks = $input.all().map(item => item.json);\nconst employees = {};\n\n// –°–ª–æ–≤–∞—Ä—å –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª –ø—Ä–æ–ø–∏—Å—å—é –≤ —Ü–∏—Ñ—Ä—ã\nconst numberWords = {\n  // –ñ–µ–Ω—Å–∫–∏–π —Ä–æ–¥ (–¥–ª—è \"–¥–≤–µ\")\n  \"–Ω–æ–ª—å\": 0, \"–æ–¥–Ω–∞\": 1, \"–¥–≤–µ\": 2, \"—Ç—Ä–∏\": 3, \"—á–µ—Ç—ã—Ä–µ\": 4, \"–ø—è—Ç—å\": 5,\n  \"—à–µ—Å—Ç—å\": 6, \"—Å–µ–º—å\": 7, \"–≤–æ—Å–µ–º—å\": 8, \"–¥–µ–≤—è—Ç—å\": 9, \"–¥–µ—Å—è—Ç—å\": 10,\n  \"–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å\": 11, \"–¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å\": 12, \"—Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—å\": 13, \"—á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å\": 14,\n  \"–ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å\": 15, \"—à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—å\": 16, \"—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å\": 17, \"–≤–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å\": 18,\n  \"–¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å\": 19, \"–¥–≤–∞–¥—Ü–∞—Ç—å\": 20, \"—Ç—Ä–∏–¥—Ü–∞—Ç—å\": 30, \"—Å–æ—Ä–æ–∫\": 40,\n  \"–ø—è—Ç—å–¥–µ—Å—è—Ç\": 50, \"—à–µ—Å—Ç—å–¥–µ—Å—è—Ç\": 60, \"—Å–µ–º—å–¥–µ—Å—è—Ç\": 70, \"–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç\": 80,\n  \"–¥–µ–≤—è–Ω–æ—Å—Ç–æ\": 90, \"—Å—Ç–æ\": 100, \"–¥–≤–µ—Å—Ç–∏\": 200, \"—Ç—Ä–∏—Å—Ç–∞\": 300,\n  \"—á–µ—Ç—ã—Ä–µ—Å—Ç–∞\": 400, \"–ø—è—Ç—å—Å–æ—Ç\": 500, \"—à–µ—Å—Ç—å—Å–æ—Ç\": 600, \"—Å–µ–º—å—Å–æ—Ç\": 700,\n  \"–≤–æ—Å–µ–º—å—Å–æ—Ç\": 800, \"–¥–µ–≤—è—Ç—å—Å–æ—Ç\": 900, \"—Ç—ã—Å—è—á–∞\": 1000, \"—Ç—ã—Å—è—á–∏\": 1000, \"—Ç—ã—Å—è—á\": 1000,\n  \n  // –ú—É–∂—Å–∫–æ–π —Ä–æ–¥\n  \"–æ–¥–∏–Ω\": 1, \"–¥–≤–∞\": 2\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ —á–∏—Å–ª–æ\nfunction textToNumber(text) {\n  if (!text) return NaN;\n  \n  // –ü—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –∏ —á–∏—Å—Ç–∏–º\n  const str = String(text).toLowerCase().trim();\n  \n  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ\n  const standardNum = Number(str.replace(/,/g, '.').replace(/\\s/g, ''));\n  if (!isNaN(standardNum)) return standardNum;\n  \n  // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å–ª–æ–≤–∞\n  const words = str.split(/[\\s,-]+/).filter(w => w.length > 0);\n  \n  // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Å–ª–æ–≤–∞-—á–∏—Å–ª–∞\n  let result = 0;\n  let currentNumber = 0;\n  let hasNumber = false;\n  \n  for (const word of words) {\n    if (numberWords.hasOwnProperty(word)) {\n      const value = numberWords[word];\n      \n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —á–∏—Å–µ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, \"–¥–≤–∞–¥—Ü–∞—Ç—å –æ–¥–∏–Ω\")\n      if (value >= 1000) {\n        // –¢—ã—Å—è—á–∏\n        result += (currentNumber || 1) * value;\n        currentNumber = 0;\n      } else if (value >= 100) {\n        // –°–æ—Ç–Ω–∏\n        currentNumber += value;\n      } else if (value >= 10) {\n        // –î–µ—Å—è—Ç–∫–∏\n        currentNumber += value;\n      } else {\n        // –ï–¥–∏–Ω–∏—Ü—ã\n        currentNumber += value;\n      }\n      \n      hasNumber = true;\n    } else if (word.match(/^\\d+$/)) {\n      // –ï—Å–ª–∏ —Å–ª–æ–≤–æ - —ç—Ç–æ —Ü–∏—Ñ—Ä–∞ –≤ —Å—Ç—Ä–æ–∫–µ\n      currentNumber += parseInt(word, 10);\n      hasNumber = true;\n    }\n  }\n  \n  result += currentNumber;\n  \n  // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å —á–∏—Å–ª–æ –∏–∑ —Å—Ç—Ä–æ–∫–∏\n  if (!hasNumber) {\n    const extracted = str.match(/-?\\d+\\.?\\d*/);\n    if (extracted) {\n      return Number(extracted[0]);\n    }\n    return NaN;\n  }\n  \n  return result || NaN;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞\nfunction normalizeStatus(status) {\n  if (!status) return '';\n  return String(status).trim().toLowerCase();\n}\n\n// –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ\nfor (const task of tasks) {\n  const employeeName = task[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"]?.toString().trim();\n  \n  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞\n  if (!employeeName) continue;\n\n  // –ü–æ–ª—É—á–∞–µ–º –∏ —á–∏—Å—Ç–∏–º –¥–∞–Ω–Ω—ã–µ\n  const status = normalizeStatus(task[\"–°—Ç–∞—Ç—É—Å\"]);\n  const deadline = textToNumber(task[\"–°—Ä–æ–∫ (–¥–Ω–µ–π)\"]);\n  const fact = textToNumber(task[\"–§–∞–∫—Ç (–¥–Ω–µ–π)\"]);\n\n  // –û—Ç–ª–∞–¥–∫–∞ (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)\n  // console.log(`–°–æ—Ç—Ä—É–¥–Ω–∏–∫: ${employeeName}, –°—Ä–æ–∫: ${deadline}, –§–∞–∫—Ç: ${fact}`);\n\n  // –ï—Å–ª–∏ –Ω–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É ‚Äî —Å–æ–∑–¥–∞—ë–º\n  if (!employees[employeeName]) {\n    employees[employeeName] = {\n      \"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\": employeeName,\n      \"–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á\": 0,\n      \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\": 0,\n      \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\": 0\n    };\n  }\n\n  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á\n  employees[employeeName][\"–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á\"] += 1;\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ª–∏ –∑–∞–¥–∞—á–∞\n  const isDone = (status === \"–≤—ã–ø–æ–ª–Ω–µ–Ω–æ\");\n  \n  if (isDone) {\n    employees[employeeName][\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\"] += 1;\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏ –≤ —Å—Ä–æ–∫\n    const canCompare = !isNaN(deadline) && !isNaN(fact);\n    \n    if (canCompare && fact <= deadline) {\n      employees[employeeName][\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\"] += 1;\n    }\n  }\n}\n\n// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç –≤ –º–∞—Å—Å–∏–≤\nlet result = Object.values(employees);\n\n// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∏–º–µ–Ω–∏\nresult.sort((a, b) => a[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"].localeCompare(b[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"]));\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç\nreturn result.map(emp => ({ json: emp }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        544,
        -816
      ],
      "id": "fe685d17-2ace-4ddf-bfdf-f3460c729d7d",
      "name": "–ê–Ω–∞–ª–∏–∑"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        976,
        -816
      ],
      "id": "5563223d-c0c0-4c1f-84fa-21e2367596e4",
      "name": "–û—Ç–≤–µ—Ç",
      "webhookId": "ef09465b-875f-40dc-8797-8dc2d116b66e",
      "credentials": {
        "telegramApi": {
          "id": "tA1BREjnYhtL43R3",
          "name": "irbsac19076_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞\nconst inputData = $input.all();\nconst tasks = inputData.map(item => item.json); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∑–∞–¥–∞—á\nconst file_name = $('Telegram Trigger').first().json.message.document.file_name;\n// –°–æ—Ö—Ä–∞–Ω—è–µ–º chatId –∏–∑ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è Telegram\nconst chatId = $('Telegram Trigger').first().json.message.chat.id;\n\nconst employees = {};\n\n// –°–ª–æ–≤–∞—Ä—å –¥–ª—è —á–∏—Å–µ–ª –ø—Ä–æ–ø–∏—Å—å—é\nconst numberWords = {\n  \"–Ω–æ–ª—å\": 0, \"–æ–¥–∏–Ω\": 1, \"–æ–¥–Ω–∞\": 1, \"–¥–≤–∞\": 2, \"–¥–≤–µ\": 2, \"—Ç—Ä–∏\": 3,\n  \"—á–µ—Ç—ã—Ä–µ\": 4, \"–ø—è—Ç—å\": 5, \"—à–µ—Å—Ç—å\": 6, \"—Å–µ–º—å\": 7, \"–≤–æ—Å–µ–º—å\": 8,\n  \"–¥–µ–≤—è—Ç—å\": 9, \"–¥–µ—Å—è—Ç—å\": 10, \"–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å\": 11, \"–¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å\": 12,\n  \"—Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—å\": 13, \"—á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å\": 14, \"–ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å\": 15, \"—à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—å\": 16,\n  \"—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å\": 17, \"–≤–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å\": 18, \"–¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å\": 19, \"–¥–≤–∞–¥—Ü–∞—Ç—å\": 20,\n  \"—Ç—Ä–∏–¥—Ü–∞—Ç—å\": 30, \"—Å–æ—Ä–æ–∫\": 40, \"–ø—è—Ç—å–¥–µ—Å—è—Ç\": 50, \"—à–µ—Å—Ç—å–¥–µ—Å—è—Ç\": 60,\n  \"—Å–µ–º—å–¥–µ—Å—è—Ç\": 70, \"–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç\": 80, \"–¥–µ–≤—è–Ω–æ—Å—Ç–æ\": 90, \"—Å—Ç–æ\": 100\n};\n\nfunction textToNumber(text) {\n  if (text === undefined || text === null || text === '') return NaN;\n  \n  const str = String(text).toLowerCase().trim();\n  \n  // –ü—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (—á–∏—Å–ª–∞, \"5\", \"5.5\")\n  const standardNum = Number(str.replace(/,/g, '.').replace(/\\s/g, ''));\n  if (!isNaN(standardNum)) return standardNum;\n  \n  // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –≤ —Å–ª–æ–≤–∞—Ä–µ\n  if (numberWords.hasOwnProperty(str)) return numberWords[str];\n  \n  return NaN;\n}\n\nfunction normalizeStatus(status) {\n  if (!status) return '';\n  return String(status).trim().toLowerCase();\n}\n\n// –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ (—Å —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–æ–π \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\")\nconst originalTasks = [];\n\nfor (const task of tasks) {\n  const employeeName = task[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"]?.toString().trim();\n  if (!employeeName) continue;\n\n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏ –≤ —Å—Ä–æ–∫\n  const status = normalizeStatus(task[\"–°—Ç–∞—Ç—É—Å\"]);\n  const deadline = textToNumber(task[\"–°—Ä–æ–∫ (–¥–Ω–µ–π)\"]);\n  const fact = textToNumber(task[\"–§–∞–∫—Ç (–¥–Ω–µ–π)\"]);\n  \n  const isDone = (status === \"–≤—ã–ø–æ–ª–Ω–µ–Ω–æ\");\n  let isOnTime = \"–ù–µ—Ç\";\n  \n  if (isDone && !isNaN(deadline) && !isNaN(fact) && fact <= deadline) {\n    isOnTime = \"–î–∞\";\n  }\n  \n  // –°–æ–∑–¥–∞—ë–º –∫–æ–ø–∏—é –∑–∞–¥–∞—á–∏ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –ø–æ–ª–µ–º \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\"\n  const enrichedTask = { ...task };\n  enrichedTask[\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\"] = isOnTime;\n  originalTasks.push(enrichedTask);\n\n  // –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º\n  if (!employees[employeeName]) {\n    employees[employeeName] = {\n      \"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\": employeeName,\n      \"–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á\": 0,\n      \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\": 0,\n      \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\": 0\n    };\n  }\n\n  employees[employeeName][\"–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á\"] += 1;\n\n  if (isDone) {\n    employees[employeeName][\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\"] += 1;\n    if (isOnTime === \"–î–∞\") {\n      employees[employeeName][\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\"] += 1;\n    }\n  }\n}\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–≤–æ–¥–∫—É\nconst summary = Object.values(employees);\nsummary.sort((a, b) => a[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"].localeCompare(b[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"]));\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤\nreturn [{\n  json: {\n    chatId: chatId,\n    file_name: file_name,\n    originalTasks: originalTasks,\n    summary: summary\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        544,
        -560
      ],
      "id": "bfcdc8d7-86c8-4cfc-8552-c68c07fbc0fe",
      "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.item.json;\nconst originalTasks = input.originalTasks || [];\n\n// –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç —Å –Ω—É–∂–Ω—ã–º–∏ –ø–æ–ª—è–º–∏\nconst tasksRows = originalTasks.map(task => ({\n  \"ID –∑–∞–¥–∞—á–∏\": task[\"ID –∑–∞–¥–∞—á–∏\"] || \"\",\n  \"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\": task[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"] || \"\",\n  \"–û—Ç–¥–µ–ª\": task[\"–û—Ç–¥–µ–ª\"] || \"\",\n  \"–°—Ä–æ–∫ (–¥–Ω–µ–π)\": task[\"–°—Ä–æ–∫ (–¥–Ω–µ–π)\"] || \"\",\n  \"–°—Ç–∞—Ç—É—Å\": task[\"–°—Ç–∞—Ç—É—Å\"] || \"\",\n  \"–§–∞–∫—Ç (–¥–Ω–µ–π)\": task[\"–§–∞–∫—Ç (–¥–Ω–µ–π)\"] || \"\",\n  \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\": task[\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\"] || \"–ù–µ—Ç\"\n}));\n\n// –í–û–ó–í–†–ê–©–ê–ï–ú –ß–ò–°–¢–´–ô –ú–ê–°–°–ò–í –ó–ê–î–ê–ß\nreturn tasksRows;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        752,
        -608
      ],
      "id": "55437d2b-3273-4216-940a-a164fcad70d8",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ó–∞–¥–∞—á–∏"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.item.json;\nconst summary = input.summary || [];\n\nconst summaryRows = [];\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º\nfor (const emp of summary) {\n  summaryRows.push({\n    \"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\": emp[\"–°–æ—Ç—Ä—É–¥–Ω–∏–∫\"],\n    \"–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á\": emp[\"–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á\"],\n    \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\": emp[\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\"],\n    \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\": emp[\"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫\"]\n  });\n}\n\n// –í–û–ó–í–†–ê–©–ê–ï–ú –ß–ò–°–¢–´–ô –ú–ê–°–°–ò–í (n8n —Å–∞–º –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ items)\nreturn summaryRows;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        752,
        -416
      ],
      "id": "7391799c-55c1-468c-bf1b-a60c3f524403",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –°–≤–æ–¥"
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "={{ $('–û–±—Ä–∞–±–æ—Ç–∫–∞').item.json.chatId }}",
        "binaryData": true,
        "binaryPropertyName": "file",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1296,
        -528
      ],
      "id": "2a1f34fa-efaf-45ef-bccf-4e6a6c533045",
      "name": "Send a document",
      "webhookId": "01725173-b28c-46e1-bb57-ec7d0c0ab771",
      "credentials": {
        "telegramApi": {
          "id": "tA1BREjnYhtL43R3",
          "name": "irbsac19076_bot"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If xlsx",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û—Ç—á–µ—Ç": {
      "main": [
        [
          {
            "node": "–û—Ç–≤–µ—Ç",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If xlsx": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get File": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "–ê–Ω–∞–ª–∏–∑",
            "type": "main",
            "index": 0
          },
          {
            "node": "–û–±—Ä–∞–±–æ—Ç–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "Send a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Send a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–Ω–∞–ª–∏–∑": {
      "main": [
        [
          {
            "node": "–û—Ç—á–µ—Ç",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û—Ç–≤–µ—Ç": {
      "main": [
        []
      ]
    },
    "–û–±—Ä–∞–±–æ—Ç–∫–∞": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ó–∞–¥–∞—á–∏",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –°–≤–æ–¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ó–∞–¥–∞—á–∏": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –°–≤–æ–¥": {
      "main": [
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a document": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "timezone": "Europe/Moscow",
    "callerPolicy": "workflowsFromSameOwner",
    "executionTimeout": 300,
    "errorWorkflow": "ZvIoUnAHS7UQKCqs",
    "availableInMCP": false
  },
  "versionId": "e39e03dd-abb0-44e0-bc26-2dc2919d666e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "b17939e3a1338efe3526dbbbd76efcf429ce60984ff205ad9d863d902dade11b"
  },
  "id": "gvubv9XjlAyfbXWs",
  "tags": []
}